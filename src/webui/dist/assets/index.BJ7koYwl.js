import{j as e}from"./jsx-runtime.rd1UdKLT.js";import{u as N,L as w,c as p,a}from"./helpers.D4dze-xh.js";import{ai as k,aj as C,ak as $,al as S,am as F,an as l,ao as R}from"./EllipsisVerticalIcon.ByMy5VQe.js";import{H as A}from"./header.C1RbunZQ.js";import{r as i}from"./index.CYTk6vBG.js";import"./store.Bn0h-d5G.js";import"./index.XsjW1gQD.js";const K=n=>{const t=N([]),[d,h]=i.useState(""),[m,b]=i.useState("all"),g={online:"bg-emerald-400",stopped:"bg-red-500",crashed:"bg-amber-400"};async function c(){t.clear(),(await a.get(n.base+"/list").json()).map(r=>t.push({...r,server:"local"}));try{await(await a.get(n.base+"/daemon/servers").json()).forEach(async u=>{(await a.get(n.base+`/remote/${u}/list`).json()).map(y=>t.push({...y,server:u}))})}catch{}}const j=s=>s.server!="local",x=s=>s=="stopped"?!1:s!="crashed",o=(s,r)=>a.post(`${n.base}/process/${s}/action`,{json:{method:r}}).then(()=>c()),v=async()=>{try{await a.post(`${n.base}/daemon/save`,{}),alert("All processes saved to dumpfile")}catch(s){alert("Failed to save processes: "+s.message)}},z=async()=>{try{await a.post(`${n.base}/daemon/restore`,{}),c(),alert("All processes restored from dumpfile")}catch(s){alert("Failed to restore processes: "+s.message)}},f=t.value.filter(s=>{const r=d===""||s.name.toLowerCase().includes(d.toLowerCase())||s.server.toLowerCase().includes(d.toLowerCase()),u=m==="all"||s.status===m;return r&&u});return i.useEffect(()=>{c()},[]),t.isEmpty()?e.jsx(w,{}):e.jsxs(i.Fragment,{children:[e.jsx(A,{name:`Viewing ${f.length} of ${t.count()} items`,description:"View and manage all the processes on your daemons.",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:v,className:"transition inline-flex items-center justify-center space-x-1.5 border focus:outline-none focus:ring-0 focus:ring-offset-0 focus:z-10 shrink-0 border-zinc-700 hover:border-zinc-600 bg-zinc-800 text-zinc-50 hover:bg-zinc-700 px-3 py-2 text-sm font-semibold rounded-lg",children:"Save All"}),e.jsx("button",{type:"button",onClick:z,className:"transition inline-flex items-center justify-center space-x-1.5 border focus:outline-none focus:ring-0 focus:ring-offset-0 focus:z-10 shrink-0 border-zinc-700 hover:border-zinc-600 bg-zinc-800 text-zinc-50 hover:bg-zinc-700 px-3 py-2 text-sm font-semibold rounded-lg",children:"Restore All"}),e.jsx("button",{type:"button",onClick:c,className:"transition inline-flex items-center justify-center space-x-1.5 border focus:outline-none focus:ring-0 focus:ring-offset-0 focus:z-10 shrink-0 border-zinc-900 hover:border-zinc-800 bg-zinc-950 text-zinc-50 hover:bg-zinc-900 px-4 py-2 text-sm font-semibold rounded-lg",children:"Refresh"})]})}),e.jsxs("div",{className:"px-8 pb-4 flex gap-4 items-center",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",placeholder:"Search by name or server...",value:d,onChange:s=>h(s.target.value),className:"w-full px-4 py-2 bg-zinc-900/50 border border-zinc-700/50 rounded-lg text-zinc-200 placeholder-zinc-500 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500"})}),e.jsx("div",{children:e.jsxs("select",{value:m,onChange:s=>b(s.target.value),className:"px-4 py-2 bg-zinc-900/50 border border-zinc-700/50 rounded-lg text-zinc-200 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"online",children:"Online"}),e.jsx("option",{value:"stopped",children:"Stopped"}),e.jsx("option",{value:"crashed",children:"Crashed"})]})})]}),e.jsx("ul",{role:"list",className:"px-8 pb-8 grid grid-cols-1 gap-x-6 gap-y-8 lg:grid-cols-4 xl:gap-x-8",children:f.map(s=>e.jsxs("li",{className:"rounded-lg border border-zinc-700/50 bg-zinc-900/10 hover:bg-zinc-900/40 hover:border-zinc-700",children:[e.jsxs("div",{className:"flex items-center gap-x-4 border-b border-zinc-800/80 bg-zinc-900/20 px-4 py-3",children:[e.jsxs("span",{className:"text-md font-bold text-zinc-200 truncate",children:[s.name,e.jsx("div",{className:"text-xs font-medium text-zinc-400",children:s.server!="local"?s.server:"Internal"})]}),e.jsx("span",{className:"relative flex h-2 w-2 -mt-3.5 -ml-2",children:e.jsx("span",{className:`${g[s.status]} relative inline-flex rounded-full h-2 w-2`})}),e.jsxs(k,{as:"div",className:"relative ml-auto",children:[e.jsx(C,{className:"transition border focus:outline-none focus:ring-0 focus:ring-offset-0 z-50 shrink-0 border-zinc-700/50 bg-transparent hover:bg-zinc-800 p-2 text-sm font-semibold rounded-lg ml-3",children:e.jsx($,{className:"h-5 w-5 text-zinc-50","aria-hidden":"true"})}),e.jsx(S,{as:i.Fragment,enter:"transition ease-out duration-100",enterFrom:"transform opacity-0 scale-95",enterTo:"transform opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100 scale-100",leaveTo:"transform opacity-0 scale-95",children:e.jsxs(F,{anchor:{to:"bottom end",gap:"8px",padding:"16px"},className:"z-10 w-48 origin-top-right rounded-lg bg-zinc-900 border border-zinc-800 shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none text-base divide-y divide-zinc-800/50",children:[e.jsxs("div",{className:"p-1.5",children:[e.jsx(l,{children:({focus:r})=>e.jsx("a",{onClick:()=>o(s.id,"restart"),className:p(r?"bg-green-700/10 text-green-500":"text-zinc-200","rounded-md block px-2 py-2 w-full text-left cursor-pointer"),children:"Restart"})}),e.jsx(l,{children:({focus:r})=>e.jsx("a",{onClick:()=>o(s.id,"reload"),className:p(r?"bg-blue-700/10 text-blue-500":"text-zinc-200","rounded-md block px-2 py-2 w-full text-left cursor-pointer"),children:"Reload"})}),e.jsx(l,{children:({focus:r})=>e.jsx("a",{onClick:()=>o(s.id,"stop"),className:p(r?"bg-yellow-400/10 text-amber-500":"text-zinc-200","rounded-md block p-2 w-full text-left cursor-pointer"),children:"Terminate"})})]}),e.jsxs("div",{className:"p-1.5",children:[e.jsx(l,{children:({_:r})=>e.jsx(R,{base:n.base,server:s.server,process_id:s.id,callback:c,old:s.name})}),e.jsx(l,{children:({_:r})=>e.jsx("a",{onClick:()=>o(s.id,"flush"),className:"text-zinc-200 rounded-md block p-2 w-full text-left cursor-pointer hover:bg-zinc-800/80 hover:text-zinc-50",children:"Clean Logs"})})]}),e.jsx("div",{className:"p-1.5",children:e.jsx(l,{children:({focus:r})=>e.jsx("a",{onClick:()=>o(s.id,"delete"),className:p(r?"bg-red-700/10 text-red-500":"text-red-400","rounded-md block p-2 w-full text-left cursor-pointer"),children:"Delete"})})})]})})]})]}),e.jsx("a",{href:j(s)?`./view/${s.id}?server=${s.server}`:`./view/${s.id}`,children:e.jsxs("dl",{className:"-my-3 divide-y divide-zinc-800/30 px-6 py-4 text-sm leading-6",children:[e.jsxs("div",{className:"flex justify-between gap-x-1 py-1",children:[e.jsx("dt",{className:"text-zinc-700",children:"cpu usage"}),e.jsx("dd",{className:"text-zinc-500",children:x(s.status)?s.cpu:"offline"})]}),e.jsxs("div",{className:"flex justify-between gap-x-1 py-1",children:[e.jsx("dt",{className:"text-zinc-700",children:"memory"}),e.jsx("dd",{className:"text-zinc-500",children:x(s.status)?s.mem:"offline"})]}),e.jsxs("div",{className:"flex justify-between gap-x-1 py-1",children:[e.jsx("dt",{className:"text-zinc-700",children:"pid"}),e.jsx("dd",{className:"text-zinc-500",children:x(s.status)?s.pid:"none"})]}),e.jsxs("div",{className:"flex justify-between gap-x-1 py-1",children:[e.jsx("dt",{className:"text-zinc-700",children:"uptime"}),e.jsx("dd",{className:"text-zinc-500",children:x(s.status)?s.uptime:"none"})]}),e.jsxs("div",{className:"flex justify-between gap-x-1 py-1",children:[e.jsx("dt",{className:"text-zinc-700",children:"restarts"}),e.jsx("dd",{className:"text-zinc-500",children:s.restarts==0?"none":s.restarts})]})]})})]},s.id+s.name))})]})};export{K as default};
