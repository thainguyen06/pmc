let u=[],c=(e,f)=>{let t=[],l={get(){return l.lc||l.listen(()=>{})(),l.value},l:0,lc:0,listen(s,i){return l.lc=t.push(s,i||l.l)/2,()=>{let n=t.indexOf(s);~n&&(t.splice(n,2),--l.lc||l.off())}},notify(s){let i=!u.length;for(let n=0;n<t.length;n+=2)u.push(t[n],t[n+1],l.value,s);if(i){for(let n=0;n<u.length;n+=4){let E;for(let a=n+1;!E&&(a+=4)<u.length;)u[a]<u[n+1]&&(E=u.push(u[n],u[n+1],u[n+2],u[n+3]));E||u[n](u[n+2],u[n+3])}u.length=0}},off(){},set(s){l.value!==s&&(l.value=s,l.notify())},subscribe(s,i){let n=l.listen(s,i);return s(l.value),n},value:e};return l};let h=(e,f,t,l)=>(e.events=e.events||{},e.events[t+10]||(e.events[t+10]=l(s=>{e.events[t].reduceRight((i,n)=>(n(i),i),{shared:{},...s})})),e.events[t]=e.events[t]||[],e.events[t].push(f),()=>{let s=e.events[t],i=s.indexOf(f);s.splice(i,1),s.length||(delete e.events[t],e.events[t+10](),delete e.events[t+10])}),N=1e3,U=(e,f)=>h(e,l=>{let s=f(l);s&&e.events[6].push(s)},5,l=>{let s=e.listen;e.listen=(...n)=>(!e.lc&&!e.active&&(e.active=!0,l()),s(...n));let i=e.off;return e.events[6]=[],e.off=()=>{i(),setTimeout(()=>{if(e.active&&!e.lc){e.active=!1;for(let n of e.events[6])n();e.events[6]=[]}},N)},()=>{e.listen=s,e.off=i}}),L=(e={})=>{let f=c(e);return f.setKey=function(t,l){typeof l>"u"?t in f.value&&(f.value={...f.value},delete f.value[t],f.notify(t)):f.value[t]!==l&&(f.value={...f.value,[t]:l},f.notify(t))},f},g=e=>e,T={},d={addEventListener(){},removeEventListener(){}};function M(){try{return typeof localStorage<"u"}catch{return!1}}M()&&(T=localStorage);let O={addEventListener(e,f,t){window.addEventListener("storage",f),window.addEventListener("pageshow",t)},removeEventListener(e,f,t){window.removeEventListener("storage",f),window.removeEventListener("pageshow",t)}};typeof window<"u"&&(d=O);function m(e,f={},t={}){let l=t.encode||g,s=t.decode||g,i=L(),n=i.setKey;i.setKey=(r,v)=>{typeof v>"u"?(t.listen!==!1&&d.perKey&&d.removeEventListener(e+r,a,o),delete T[e+r]):(t.listen!==!1&&d.perKey&&!(r in i.value)&&d.addEventListener(e+r,a,o),T[e+r]=l(v)),n(r,v)};let E=i.set;i.set=function(r){for(let v in r)i.setKey(v,r[v]);for(let v in i.value)v in r||i.setKey(v)};function a(r){r.key?r.key.startsWith(e)&&(r.newValue===null?n(r.key.slice(e.length),void 0):n(r.key.slice(e.length),s(r.newValue))):E({})}function o(){let r={...f};for(let v in T)v.startsWith(e)&&(r[v.slice(e.length)]=s(T[v]));i.set(r)}return U(i,()=>{if(o(),t.listen!==!1)return d.addEventListener(e,a,o),()=>{d.removeEventListener(e,a,o);for(let r in i.value)d.removeEventListener(e+r,a,o)}}),i}const R=m("settings:",{});export{R as $};
