import{j as e}from"./jsx-runtime.rd1UdKLT.js";import{L as f,a as m}from"./loader.BaX-dSmh.js";import{r as i}from"./index.CYTk6vBG.js";import{H as j}from"./header.DThMhDdz.js";import{c as x,f as N,s as u}from"./helpers.D_n2Z14X.js";import{c as v}from"./client.iZ9HAnUQ.js";import"./store.Bn0h-d5G.js";import"./index.XsjW1gQD.js";const z=n=>{const[s,p]=i.useState(null),[a,d]=i.useState([]),[g,b]=i.useState(!0),c={online:"bg-emerald-400/10 text-emerald-400",offline:"bg-red-500/10 text-red-500",running:"bg-emerald-700/40 text-emerald-400",stopped:"bg-red-700/40 text-red-400"};async function l(){try{const t=await m.get(`${n.base}/daemon/agents/${n.agentId}`).json();p(t);try{const r=await m.get(`${n.base}/daemon/agents/${n.agentId}/processes`).json();d(Array.isArray(r)?r:[])}catch{d([])}}catch(t){console.error("Failed to fetch agent details:",t)}finally{b(!1)}}if(i.useEffect(()=>{l();const t=setInterval(l,5e3);return()=>clearInterval(t)},[n.agentId]),g||!s)return e.jsx(f,{});const o=s.last_heartbeat&&Date.now()-new Date(s.last_heartbeat).getTime()<3e4;return e.jsxs(i.Fragment,{children:[e.jsx(j,{name:`Agent: ${s.name}`,description:"Detailed information about this agent and its processes.",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:l,className:"transition inline-flex items-center justify-center space-x-1.5 border focus:outline-none focus:ring-0 focus:ring-offset-0 focus:z-10 shrink-0 border-zinc-900 hover:border-zinc-800 bg-zinc-950 text-zinc-50 hover:bg-zinc-900 px-4 py-2 text-sm font-semibold rounded-lg",children:"Refresh"}),e.jsx("a",{href:`${n.base}/servers`,className:"transition inline-flex items-center justify-center space-x-1.5 border focus:outline-none focus:ring-0 focus:ring-offset-0 focus:z-10 shrink-0 border-zinc-700 hover:border-zinc-600 bg-zinc-800 text-zinc-50 hover:bg-zinc-700 px-4 py-2 text-sm font-semibold rounded-lg",children:"Back to Agents"})]})}),e.jsxs("div",{className:"bg-zinc-900 border border-zinc-800 rounded-lg p-6 mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-zinc-200 mb-4",children:"Agent Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-zinc-400 mb-1",children:"Status"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:x(c[o?"online":"offline"],"flex-none rounded-full p-1"),children:e.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-current"})}),e.jsx("span",{className:"text-zinc-200 font-medium",children:o?"Online":"Offline"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-zinc-400 mb-1",children:"Agent ID"}),e.jsx("div",{className:"text-zinc-200 font-mono text-sm",children:s.id})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-zinc-400 mb-1",children:"Hostname"}),e.jsx("div",{className:"text-zinc-200",children:s.hostname||"N/A"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-zinc-400 mb-1",children:"Connection Type"}),e.jsx("div",{className:"text-zinc-200",children:s.connection_type||"In"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-zinc-400 mb-1",children:"Last Heartbeat"}),e.jsx("div",{className:"text-zinc-200",children:s.last_heartbeat?new Date(s.last_heartbeat).toLocaleString():"Never"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-zinc-400 mb-1",children:"Connected Since"}),e.jsx("div",{className:"text-zinc-200",children:s.connected_at?new Date(s.connected_at).toLocaleString():"N/A"})]})]})]}),e.jsxs("div",{className:"bg-zinc-900 border border-zinc-800 rounded-lg p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-zinc-200 mb-4",children:["Processes (",a.length,")"]}),a.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-zinc-400",children:"No processes running on this agent"}),e.jsx("div",{className:"text-zinc-500 text-sm mt-2",children:"Processes started via this agent will appear here"})]}):e.jsxs("table",{className:"w-full whitespace-nowrap text-left",children:[e.jsx("thead",{className:"border-b border-zinc-800 text-sm leading-6 text-zinc-400",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"py-2 pl-4 pr-8 font-semibold",children:"Name"}),e.jsx("th",{scope:"col",className:"hidden py-2 pl-0 pr-8 font-semibold sm:table-cell",children:"PID"}),e.jsx("th",{scope:"col",className:"hidden py-2 pl-0 pr-8 font-semibold sm:table-cell",children:"Status"}),e.jsx("th",{scope:"col",className:"hidden py-2 pl-0 pr-8 font-semibold md:table-cell",children:"CPU"}),e.jsx("th",{scope:"col",className:"hidden py-2 pl-0 pr-8 font-semibold md:table-cell",children:"Memory"}),e.jsx("th",{scope:"col",className:"py-2 pl-0 pr-4 text-right font-semibold",children:"Uptime"})]})}),e.jsx("tbody",{className:"divide-y divide-zinc-800",children:a.map(t=>e.jsxs("tr",{className:"hover:bg-zinc-800/30 transition",children:[e.jsx("td",{className:"py-3 pl-4 pr-8",children:e.jsx("div",{className:"text-sm font-medium text-white",children:t.name})}),e.jsx("td",{className:"hidden py-3 pl-0 pr-8 sm:table-cell",children:e.jsx("div",{className:"text-sm text-zinc-400 font-mono",children:t.pid||"N/A"})}),e.jsx("td",{className:"hidden py-3 pl-0 pr-8 sm:table-cell",children:e.jsx("div",{className:x(t.running?c.running:c.stopped,"inline-flex rounded-md px-2 py-1 text-xs font-medium ring-1 ring-inset ring-white/10"),children:t.running?"Running":"Stopped"})}),e.jsx("td",{className:"hidden py-3 pl-0 pr-8 md:table-cell",children:e.jsx("div",{className:"text-sm text-zinc-400",children:t.cpu?`${t.cpu.toFixed(1)}%`:"N/A"})}),e.jsx("td",{className:"hidden py-3 pl-0 pr-8 md:table-cell",children:e.jsx("div",{className:"text-sm text-zinc-400",children:t.memory?N(t.memory):"N/A"})}),e.jsx("td",{className:"py-3 pl-0 pr-4 text-right",children:e.jsx("div",{className:"text-sm text-zinc-400",children:t.uptime?u(t.uptime,!1):"N/A"})})]},t.id))})]})]})]})},y=window.location.hash.substring(1),w=y||"unknown",A="{{base_path | safe}}",h=document.getElementById("agent-detail-root");h&&v.createRoot(h).render(i.createElement(z,{agentId:w,base:A}));
