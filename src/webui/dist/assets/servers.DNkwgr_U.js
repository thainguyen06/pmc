import{j as e}from"./jsx-runtime.rd1UdKLT.js";import{u as z,L as S,c as d,s as f,a as i,b as k}from"./helpers.D4dze-xh.js";import{r as a}from"./index.CYTk6vBG.js";import{H as A}from"./header.C1RbunZQ.js";import"./store.Bn0h-d5G.js";const j="2.0.0",C=(t,n)=>{const l={updated:"bg-emerald-700/40 text-emerald-400",behind:"bg-gray-700/40 text-gray-400",critical:"bg-red-700/40 text-red-400"};return t=="v0.0.0"||k(j,t.slice(1))?l.behind:t==`v${j}`?l.updated:l[n??"critical"]},L={os:{name:""},version:{pkg:"v0.0.0",hash:"none",build_date:"none",target:""},daemon:{pid:"none",running:!1,uptime:0,process_count:"none"}},$=(t,n)=>{const r=["Alpine","Arch","Amazon","Macos","Linux","Fedora","Debian","CentOS","NixOS","FreeBSD","OpenBSD","OracleLinux","Pop","Raspbian","Redhat","Ubuntu"].includes(n);return`${t}/assets/${r?n.toLowerCase():"unknown"}.svg`},I=t=>{const n=z([]),[l,r]=a.useState(!1),[m,p]=a.useState(""),[x,u]=a.useState(""),[b,h]=a.useState(""),N={online:"bg-emerald-400/10 text-emerald-400",offline:"bg-red-500/10 text-red-500"};async function c(){n.clear();const s=await i.get(t.base+"/daemon/metrics").json();n.push({...s,name:"local"});try{await(await i.get(t.base+"/daemon/servers").json()).forEach(async g=>{i.get(t.base+`/remote/${g}/metrics`).json().then(w=>n.push({...w,name:g})).catch(()=>n.push({...L,name:g}))})}catch{}}const y=async()=>{try{await i.post(`${t.base}/daemon/servers/add`,{json:{name:m,address:x,token:b||null}}),r(!1),p(""),u(""),h(""),c(),alert("Server added successfully")}catch(s){alert("Failed to add server: "+s.message)}},v=async s=>{if(confirm(`Are you sure you want to remove server "${s}"?`))try{await i.delete(`${t.base}/daemon/servers/${s}`),c(),alert("Server removed successfully")}catch(o){alert("Failed to remove server: "+o.message)}};return a.useEffect(()=>{c()},[]),n.isEmpty()?e.jsx(S,{}):e.jsxs(a.Fragment,{children:[e.jsx(A,{name:"Servers",description:"A list of all the servers in your daemon config.",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>r(!0),className:"transition inline-flex items-center justify-center space-x-1.5 border focus:outline-none focus:ring-0 focus:ring-offset-0 focus:z-10 shrink-0 border-zinc-700 hover:border-zinc-600 bg-zinc-800 text-zinc-50 hover:bg-zinc-700 px-3 py-2 text-sm font-semibold rounded-lg",children:"Add Server"}),e.jsx("button",{type:"button",onClick:c,className:"transition inline-flex items-center justify-center space-x-1.5 border focus:outline-none focus:ring-0 focus:ring-offset-0 focus:z-10 shrink-0 border-zinc-900 hover:border-zinc-800 bg-zinc-950 text-zinc-50 hover:bg-zinc-900 px-4 py-2 text-sm font-semibold rounded-lg",children:"Refresh"})]})}),l&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-zinc-900 border border-zinc-800 rounded-lg p-6 w-full max-w-md",children:[e.jsx("h2",{className:"text-xl font-bold text-zinc-200 mb-4",children:"Add New Server"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-300 mb-2",children:"Server Name"}),e.jsx("input",{type:"text",value:m,onChange:s=>p(s.target.value),placeholder:"e.g., production",className:"w-full px-4 py-2 bg-zinc-800 border border-zinc-700 rounded-lg text-zinc-200 placeholder-zinc-500 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-300 mb-2",children:"Server Address (IP/URL)"}),e.jsx("input",{type:"text",value:x,onChange:s=>u(s.target.value),placeholder:"e.g., http://192.168.1.100:9876",className:"w-full px-4 py-2 bg-zinc-800 border border-zinc-700 rounded-lg text-zinc-200 placeholder-zinc-500 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-300 mb-2",children:"Token (Optional)"}),e.jsx("input",{type:"text",value:b,onChange:s=>h(s.target.value),placeholder:"Authentication token",className:"w-full px-4 py-2 bg-zinc-800 border border-zinc-700 rounded-lg text-zinc-200 placeholder-zinc-500 focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"flex gap-2 mt-6",children:[e.jsx("button",{onClick:y,disabled:!m||!x,className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-zinc-700 disabled:cursor-not-allowed text-white rounded-lg font-medium transition",children:"Add Server"}),e.jsx("button",{onClick:()=>{r(!1),p(""),u(""),h("")},className:"flex-1 px-4 py-2 bg-zinc-800 hover:bg-zinc-700 text-zinc-200 rounded-lg font-medium transition",children:"Cancel"})]})]})}),e.jsxs("table",{className:"w-full whitespace-nowrap text-left",children:[e.jsxs("colgroup",{children:[e.jsx("col",{className:"w-full sm:w-3/12"}),e.jsx("col",{className:"lg:w-[10%]"}),e.jsx("col",{className:"lg:w-2/12"}),e.jsx("col",{className:"lg:w-2/12"}),e.jsx("col",{className:"lg:w-1/12"}),e.jsx("col",{className:"lg:w-1/12"}),e.jsx("col",{className:"lg:w-1/12"}),e.jsx("col",{className:"lg:w-1/12"})]}),e.jsx("thead",{className:"sticky top-0 z-10 bg-zinc-950 bg-opacity-75 backdrop-blur backdrop-filter border-b border-white/10 text-sm leading-6 text-white",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"py-2 pl-4 pr-8 font-semibold sm:pl-6 lg:pl-8",children:"Server"}),e.jsx("th",{scope:"col",className:"py-2 pl-0 pr-8 font-semibold table-cell",children:"Version"}),e.jsx("th",{scope:"col",className:"hidden py-2 pl-0 pr-8 font-semibold sm:table-cell",children:"Build"}),e.jsx("th",{scope:"col",className:"hidden py-2 pl-0 pr-8 font-semibold sm:table-cell",children:"Hash"}),e.jsx("th",{scope:"col",className:"hidden py-2 pl-0 pr-8 font-semibold sm:table-cell",children:"Process Id"}),e.jsx("th",{scope:"col",className:"hidden py-2 pl-0 pr-8 font-semibold md:table-cell lg:pr-20",children:"Count"}),e.jsx("th",{scope:"col",className:"hidden py-2 pl-0 pr-4 font-semibold md:table-cell lg:pr-20",children:"Status"}),e.jsx("th",{scope:"col",className:"py-2 pl-0 pr-4 text-right font-semibold sm:table-cell sm:pr-6 lg:pr-8",children:"Uptime"}),e.jsx("th",{scope:"col",className:"py-2 pl-0 pr-4 text-right font-semibold sm:pr-6 lg:pr-8",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-white/5 border-b border-white/5",children:n.value.sort().map(s=>e.jsxs("tr",{className:d(s.daemon.running&&"hover:bg-zinc-800/30 cursor-pointer","transition"),onClick:()=>s.daemon.running&&(window.location.href=t.base+"/status/"+s.name),children:[e.jsx("td",{className:"py-4 pl-4 pr-8 sm:pl-6 lg:pl-8",children:e.jsxs("div",{className:"flex items-center gap-x-4",children:[e.jsx("img",{src:$(t.base,s.os.name),className:d(s.daemon.running?"ring-emerald-400 bg-white":"ring-red-400 bg-red-500","h-8 w-8 rounded-full ring-2")}),e.jsx("div",{className:"truncate text-sm font-medium leading-6 text-white",children:s.name=="local"?"Internal":s.name})]})}),e.jsx("td",{className:"py-4 pl-0 pr-4 table-cell sm:pr-8",children:e.jsx("div",{className:"flex gap-x-3",children:e.jsx("div",{className:d(C(s.version.pkg,s.version.status),"rounded-md px-2 py-1 text-xs font-medium ring-1 ring-inset ring-white/10"),children:s.version.pkg})})}),e.jsx("td",{className:"hidden py-4 pl-0 pr-4 sm:table-cell sm:pr-8",children:e.jsxs("div",{className:"font-mono text-sm leading-6 text-gray-400",children:[s.version.target," ",s.version.build_date]})}),e.jsx("td",{className:"hidden py-4 pl-0 pr-4 sm:table-cell sm:pr-8",children:e.jsx("div",{className:"font-mono text-sm leading-6 text-gray-400",children:s.version.hash.slice(0,16)})}),e.jsx("td",{className:"hidden py-4 pl-0 pr-8 text-sm leading-6 text-gray-400 md:table-cell lg:pr-20 font-mono",children:s.daemon.pid}),e.jsx("td",{className:"hidden py-4 pl-0 pr-8 text-sm leading-6 text-gray-400 md:table-cell lg:pr-20",children:s.daemon.process_count}),e.jsx("td",{className:"py-4 pl-0 pr-4 text-sm leading-6 sm:pr-8 lg:pr-20",children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2 sm:justify-start",children:[e.jsx("span",{className:"text-gray-400 sm:hidden",children:s.daemon.uptime==0?"none":f(s.daemon.uptime,!1)}),e.jsx("div",{className:d(N[s.daemon.running?"online":"offline"],"flex-none rounded-full p-1"),children:e.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-current"})}),e.jsx("div",{className:"hidden text-white sm:block",children:s.daemon.running?"Online":"Offline"})]})}),e.jsx("td",{className:"hidden py-4 pl-0 pr-4 text-right text-sm leading-6 text-gray-400 sm:table-cell sm:pr-6 lg:pr-8",children:s.daemon.uptime==0?"none":f(s.daemon.uptime,!1)}),e.jsx("td",{className:"py-4 pl-0 pr-4 text-right sm:pr-6 lg:pr-8",onClick:o=>o.stopPropagation(),children:s.name!=="local"&&e.jsx("button",{onClick:()=>v(s.name),className:"text-red-400 hover:text-red-300 text-sm font-medium transition",children:"Remove"})})]},s.name))})]})]})};export{I as default};
