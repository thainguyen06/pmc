import{j as e}from"./jsx-runtime.rd1UdKLT.js";import{L as T,a as l}from"./loader.BaX-dSmh.js";import{r as a}from"./index.CYTk6vBG.js";import{H as _}from"./header.CGBGyY-E.js";import{u as E,T as L}from"./useToast.BT6XyCN3.js";import"./store.Bn0h-d5G.js";const $="toggle-switch relative inline-flex h-5 w-9 flex-shrink-0 items-center justify-start rounded-full transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:ring-offset-zinc-900",A="inline-block h-4 w-4 transform rounded-full bg-white transition-transform duration-200 leading-none flex-shrink-0",j=i=>`${$} ${i?"bg-blue-600":"bg-zinc-700"}`,N=i=>`${A} ${i?"translate-x-[1.125rem]":"translate-x-0.5"}`,D=i=>{const{toasts:v,closeToast:z,success:d,error:f}=E(),[y,k]=a.useState(!0),[m,x]=a.useState(!1),[h,b]=a.useState(!1),[s,o]=a.useState({enabled:!1,events:{agent_connect:!1,agent_disconnect:!1,process_start:!1,process_stop:!1,process_crash:!1,process_restart:!1},channels:[]}),[c,u]=a.useState("");async function g(){try{const t=await l.get(`${i.base}/daemon/config/notifications`).json();o(t||s)}catch(t){console.error("Failed to fetch notification settings:",t)}finally{k(!1)}}async function S(){x(!0);try{await l.post(`${i.base}/daemon/config/notifications`,{json:s}),d("Notification settings saved successfully")}catch(t){f("Failed to save settings: "+t.message)}finally{x(!1)}}async function w(){b(!0);try{await l.post(`${i.base}/daemon/test-notification`,{json:{title:"OPM Test Notification",message:"This is a test notification from OPM"}}),d("Test notification sent! Check your notification channels.")}catch(t){f("Failed to send test notification: "+t.message)}finally{b(!1)}}const p=()=>{c.trim()&&(o({...s,channels:[...s.channels,c.trim()]}),u(""))},C=t=>{o({...s,channels:s.channels.filter((n,r)=>r!==t)})};return a.useEffect(()=>{g()},[]),y?e.jsx(T,{}):e.jsxs(a.Fragment,{children:[e.jsx(L,{toasts:v,onClose:z}),e.jsx(_,{name:"Notification Settings",description:"Configure desktop notifications and external notification channels.",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:w,disabled:h||!s.enabled||s.channels.length===0,className:"transition inline-flex items-center justify-center space-x-1.5 border focus:outline-none focus:ring-0 focus:ring-offset-0 focus:z-10 shrink-0 border-emerald-700 hover:border-emerald-600 bg-emerald-600 text-white hover:bg-emerald-700 disabled:bg-zinc-700 disabled:border-zinc-700 disabled:cursor-not-allowed px-4 py-2 text-sm font-semibold rounded-lg",children:h?"Testing...":"Test Notification"}),e.jsx("button",{type:"button",onClick:S,disabled:m,className:"transition inline-flex items-center justify-center space-x-1.5 border focus:outline-none focus:ring-0 focus:ring-offset-0 focus:z-10 shrink-0 border-blue-700 hover:border-blue-600 bg-blue-600 text-white hover:bg-blue-700 disabled:bg-zinc-700 disabled:border-zinc-700 disabled:cursor-not-allowed px-4 py-2 text-sm font-semibold rounded-lg",children:m?"Saving...":"Save Settings"}),e.jsx("button",{type:"button",onClick:g,className:"transition inline-flex items-center justify-center space-x-1.5 border focus:outline-none focus:ring-0 focus:ring-offset-0 focus:z-10 shrink-0 border-zinc-900 hover:border-zinc-800 bg-zinc-950 text-zinc-50 hover:bg-zinc-900 px-4 py-2 text-sm font-semibold rounded-lg",children:"Refresh"})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-zinc-900 border border-zinc-800 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-zinc-200",children:"Enable Notifications"}),e.jsx("p",{className:"text-sm text-zinc-400 mt-1",children:"Master switch for all notifications"})]}),e.jsx("div",{className:"flex-shrink-0 flex items-center",children:e.jsx("button",{type:"button",onClick:()=>o({...s,enabled:!s.enabled}),className:j(s.enabled),role:"switch","aria-checked":s.enabled,children:e.jsx("span",{className:N(s.enabled)})})})]})}),e.jsxs("div",{className:"bg-zinc-900 border border-zinc-800 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-zinc-200 mb-4",children:"Event Types"}),e.jsx("div",{className:"space-y-4",children:Object.entries(s.events).map(([t,n])=>e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-zinc-200",children:t.split("_").map(r=>r.charAt(0).toUpperCase()+r.slice(1)).join(" ")}),e.jsxs("div",{className:"text-xs text-zinc-400",children:["Notify when ",t.replace("_"," ")," occurs"]})]}),e.jsx("div",{className:"flex-shrink-0 flex items-center",children:e.jsx("button",{type:"button",onClick:()=>o({...s,events:{...s.events,[t]:!n}}),disabled:!s.enabled,className:`${j(n&&s.enabled)} disabled:opacity-50 disabled:cursor-not-allowed`,role:"switch","aria-checked":n,children:e.jsx("span",{className:N(n)})})})]},t))})]}),e.jsxs("div",{className:"bg-zinc-900 border border-zinc-800 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-zinc-200 mb-2",children:"Notification Channels"}),e.jsx("p",{className:"text-sm text-zinc-400 mb-4",children:"Add external notification channels using Shoutrrr URLs (e.g., Discord, Slack, Telegram)"}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx("input",{type:"text",value:c,onChange:t=>u(t.target.value),onKeyPress:t=>t.key==="Enter"&&p(),placeholder:"discord://token@id or slack://token:token@channel",className:"flex-1 px-3 py-1.5 text-sm bg-zinc-800 border border-zinc-700 rounded-lg text-zinc-200 placeholder-zinc-500 focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("button",{onClick:p,disabled:!c.trim()||!s.enabled,className:"px-3 py-1.5 text-sm bg-blue-600 hover:bg-blue-700 disabled:bg-zinc-700 disabled:cursor-not-allowed text-white rounded-lg font-medium transition",children:"Add"})]}),s.channels.length===0?e.jsx("div",{className:"text-center py-4 text-zinc-400 text-sm",children:"No channels configured"}):e.jsx("div",{className:"space-y-2",children:s.channels.map((t,n)=>e.jsxs("div",{className:"flex items-center justify-between bg-zinc-800 border border-zinc-700 rounded-lg p-3",children:[e.jsx("div",{className:"flex-1 font-mono text-sm text-zinc-300 truncate mr-4",children:t}),e.jsx("button",{onClick:()=>C(n),className:"text-red-400 hover:text-red-300 text-sm font-medium transition",children:"Remove"})]},n))}),e.jsx("div",{className:"mt-4 p-3 bg-zinc-800 border border-zinc-700 rounded-lg",children:e.jsxs("div",{className:"text-xs text-zinc-400",children:[e.jsx("strong",{className:"text-zinc-300",children:"Examples:"}),e.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[e.jsxs("li",{children:[e.jsx("code",{className:"text-zinc-300",children:"discord://token@id"})," - Discord webhook"]}),e.jsxs("li",{children:[e.jsx("code",{className:"text-zinc-300",children:"slack://token:token@channel"})," - Slack webhook"]}),e.jsxs("li",{children:[e.jsx("code",{className:"text-zinc-300",children:"telegram://token@telegram?chats=@chat"})," - Telegram"]})]}),e.jsxs("p",{className:"mt-2",children:["See ",e.jsx("a",{href:"https://containrrr.dev/shoutrrr/",target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:underline",children:"Shoutrrr documentation"})," for more formats."]})]})})]})]})]})};export{D as default};
