import{j as e}from"./jsx-runtime.CA8WIsp6.js";import{L as g,a as o}from"./loader.mX-YeeW_.js";import{r as a}from"./index.D5GXnJd3.js";import{H as b}from"./header.DfbIX2kf.js";import{u as j,c as i}from"./helpers.C1cPHvCH.js";import"./store.Bn0h-d5G.js";const A=r=>{const l=j([]),[d,m]=a.useState(!0),[p,x]=a.useState("localhost"),h={online:"bg-emerald-400/10 text-emerald-400",offline:"bg-red-500/10 text-red-500"};a.useEffect(()=>{const s=window.location.hostname,t=window.location.port||"9876";x(`${s}:${t}`)},[]);async function n(){try{const s=await o.get(r.base+"/daemon/agents/list").json();l.clear(),Array.isArray(s)&&s.forEach(t=>l.push(t))}catch(s){console.error("Failed to fetch agents:",s),l.clear()}finally{m(!1)}}const f=async(s,t)=>{if(confirm(`Are you sure you want to remove agent "${t}"?`))try{await o.delete(`${r.base}/daemon/agents/${s}`),n()}catch(c){alert("Failed to remove agent: "+c.message)}};return a.useEffect(()=>{n();const s=setInterval(n,1e4);return()=>clearInterval(s)},[]),d?e.jsx(g,{}):e.jsxs(a.Fragment,{children:[e.jsx(b,{name:"Connected Agents",description:"A list of all agents connected to this server.",children:e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{type:"button",onClick:n,className:"transition inline-flex items-center justify-center space-x-1.5 border focus:outline-none focus:ring-0 focus:ring-offset-0 focus:z-10 shrink-0 border-zinc-900 hover:border-zinc-800 bg-zinc-950 text-zinc-50 hover:bg-zinc-900 px-4 py-2 text-sm font-semibold rounded-lg",children:"Refresh"})})}),l.isEmpty()?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-zinc-400 text-lg mb-4",children:"No agents connected"}),e.jsxs("div",{className:"text-zinc-500 text-sm space-y-2 max-w-2xl mx-auto",children:[e.jsx("p",{children:"To connect an agent to this server, run the following command on a remote machine:"}),e.jsxs("code",{className:"block bg-zinc-900 border border-zinc-800 rounded-lg px-4 py-3 text-left text-zinc-300 font-mono text-sm mt-4",children:["opm agent connect http://",p," --name my-agent"]}),e.jsx("p",{className:"mt-4 text-xs text-zinc-400",children:"Replace the hostname if needed. The command is automatically generated based on your current connection."})]})]}):e.jsxs("table",{className:"w-full whitespace-nowrap text-left",children:[e.jsxs("colgroup",{children:[e.jsx("col",{className:"w-full sm:w-3/12"}),e.jsx("col",{className:"lg:w-2/12"}),e.jsx("col",{className:"lg:w-2/12"}),e.jsx("col",{className:"lg:w-2/12"}),e.jsx("col",{className:"lg:w-2/12"}),e.jsx("col",{className:"lg:w-1/12"}),e.jsx("col",{className:"lg:w-1/12"})]}),e.jsx("thead",{className:"sticky top-0 z-10 bg-zinc-950 bg-opacity-75 backdrop-blur backdrop-filter border-b border-white/10 text-sm leading-6 text-white",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"py-2 pl-4 pr-8 font-semibold sm:pl-6 lg:pl-8",children:"Agent Name"}),e.jsx("th",{scope:"col",className:"hidden py-2 pl-0 pr-8 font-semibold sm:table-cell",children:"Hostname"}),e.jsx("th",{scope:"col",className:"hidden py-2 pl-0 pr-8 font-semibold sm:table-cell",children:"Agent ID"}),e.jsx("th",{scope:"col",className:"hidden py-2 pl-0 pr-8 font-semibold sm:table-cell",children:"Type"}),e.jsx("th",{scope:"col",className:"hidden py-2 pl-0 pr-8 font-semibold md:table-cell lg:pr-20",children:"Last Heartbeat"}),e.jsx("th",{scope:"col",className:"py-2 pl-0 pr-4 font-semibold sm:table-cell sm:pr-6 lg:pr-8",children:"Status"}),e.jsx("th",{scope:"col",className:"py-2 pl-0 pr-4 text-right font-semibold sm:pr-6 lg:pr-8",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-white/5 border-b border-white/5",children:l.value.map(s=>{const t=s.last_heartbeat&&Date.now()-new Date(s.last_heartbeat).getTime()<3e4;return e.jsxs("tr",{className:"hover:bg-zinc-800/30 transition cursor-pointer",onClick:()=>window.location.href=`${r.base}/agent-detail#${s.id}`,children:[e.jsx("td",{className:"py-4 pl-4 pr-8 sm:pl-6 lg:pl-8",children:e.jsxs("div",{className:"flex items-center gap-x-4",children:[e.jsx("div",{className:i(t?"bg-emerald-400":"bg-red-500","h-2 w-2 rounded-full")}),e.jsx("div",{className:"truncate text-sm font-medium leading-6 text-white",children:s.name})]})}),e.jsx("td",{className:"hidden py-4 pl-0 pr-4 sm:table-cell sm:pr-8",children:e.jsx("div",{className:"text-sm leading-6 text-gray-400",children:s.hostname||"N/A"})}),e.jsx("td",{className:"hidden py-4 pl-0 pr-4 sm:table-cell sm:pr-8",children:e.jsx("div",{className:"font-mono text-xs leading-6 text-gray-400",children:s.id?s.id.slice(0,8)+"...":"N/A"})}),e.jsx("td",{className:"hidden py-4 pl-0 pr-4 sm:table-cell sm:pr-8",children:e.jsx("div",{className:"text-sm leading-6 text-gray-400",children:s.connection_type||"In"})}),e.jsx("td",{className:"hidden py-4 pl-0 pr-8 text-sm leading-6 text-gray-400 md:table-cell lg:pr-20",children:s.last_heartbeat?new Date(s.last_heartbeat).toLocaleString():"Never"}),e.jsx("td",{className:"py-4 pl-0 pr-4 sm:pr-8 lg:pr-20",children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2 sm:justify-start",children:[e.jsx("div",{className:i(h[t?"online":"offline"],"flex-none rounded-full p-1"),children:e.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-current"})}),e.jsx("div",{className:"text-white",children:t?"Online":"Offline"})]})}),e.jsx("td",{className:"py-4 pl-0 pr-4 text-right sm:pr-6 lg:pr-8",onClick:c=>c.stopPropagation(),children:e.jsx("button",{onClick:()=>f(s.id,s.name),className:"text-red-400 hover:text-red-300 text-sm font-medium transition",children:"Remove"})})]},s.id)})})]})]})};export{A as default};
