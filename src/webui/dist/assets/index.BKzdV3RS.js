import{j as e}from"./jsx-runtime.rd1UdKLT.js";import{a as l,L as M}from"./loader.BaX-dSmh.js";import{r as o}from"./index.CYTk6vBG.js";import{F as H,a as V,b as G,l as q,f as J,c as Q,y as U,g as j,A as W}from"./constants.D8UmWmOe.js";import{H as E}from"./header.CGBGyY-E.js";import{u as X,c as N}from"./helpers.D_n2Z14X.js";import{u as Y,T as I,K as Z}from"./useToast.2JiqVnB-.js";import"./store.Bn0h-d5G.js";import"./index.XsjW1gQD.js";const ee=r=>{const[f,m]=o.useState(!1),[d,i]=o.useState(""),c=o.useRef(null),h=n=>i(n.target.value),w=async()=>{const n=r.server!=="local"?`${r.base}/remote/${r.server}/rename/${r.process_id}`:`${r.base}/process/${r.process_id}/rename`;try{await l.post(n,{body:d}),m(!1),r.callback(),r.onSuccess?.("Process renamed successfully")}catch(b){r.onError?.("Failed to rename process: "+b.message)}},p=()=>{i(r.old),m(!1)},S=n=>{n.key==="Enter"?(n.preventDefault(),w()):n.key==="Escape"&&p()};return o.useEffect(()=>{i(r.old)},[r.old]),o.useEffect(()=>{f&&c.current&&(c.current.focus(),c.current.select())},[f]),f?e.jsxs("div",{className:"flex items-center gap-2",onClick:n=>n.stopPropagation(),children:[e.jsx("input",{ref:c,type:"text",value:d,onChange:h,onKeyDown:S,onClick:n=>n.stopPropagation(),className:"flex-1 px-2 py-1 bg-zinc-800 border border-zinc-600 rounded text-zinc-100 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),e.jsx("button",{onClick:n=>{n.stopPropagation(),w()},className:"p-1 bg-green-600 hover:bg-green-700 rounded text-white transition-colors",title:"Save",children:e.jsx(V,{className:"h-4 w-4"})}),e.jsx("button",{onClick:n=>{n.stopPropagation(),p()},className:"p-1 bg-red-600 hover:bg-red-700 rounded text-white transition-colors",title:"Cancel",children:e.jsx(G,{className:"h-4 w-4"})})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-md font-bold text-zinc-200 truncate",children:r.old}),e.jsx("button",{onClick:n=>{n.preventDefault(),n.stopPropagation(),m(!0)},className:"opacity-0 group-hover:opacity-100 transition-opacity p-1 hover:bg-zinc-800 rounded text-zinc-400 hover:text-zinc-200",title:"Rename",children:e.jsx(H,{className:"h-4 w-4"})})]})},de=r=>{const{toasts:f,closeToast:m,success:d,error:i}=Y(),c=X([]),[h,w]=o.useState(""),[p,S]=o.useState("all"),[n,b]=o.useState(new Set),[R,C]=o.useState(!1),[P,T]=o.useState(!0),A={online:"bg-emerald-400",stopped:"bg-red-500",crashed:"bg-amber-400"};async function x(){try{c.clear(),b(new Set),(await l.get(r.base+"/list").json()).map(t=>c.push({...t,server:"local"}));try{await(await l.get(r.base+"/daemon/servers").json()).forEach(async u=>{(await l.get(r.base+`/remote/${u}/list`).json()).map(a=>c.push({...a,server:u}))})}catch{}}finally{T(!1)}}const L=s=>s.server!=="local",v=s=>!["stopped","crashed"].includes(s),g=async(s,t)=>{const u=s.server==="local"?`${r.base}/process/${s.id}/action`:`${r.base}/remote/${s.server}/action/${s.id}`;try{await l.post(u,{json:{method:t}}),await x(),d(W[t]||`${t} action completed successfully`)}catch(k){i(`Failed to ${t} process: ${k.message}`)}},D=s=>{const t=new Set(n);t.has(s)?t.delete(s):t.add(s),b(t),C(t.size>0)},O=()=>{const s=new Set(F.map(t=>t.id));b(s),C(s.size>0)},_=()=>{b(new Set),C(!1)},$=async s=>{if(n.size!==0)try{const u=c.value.filter(a=>n.has(a.id)).reduce((a,z)=>{const y=z.server||"local";return a[y]||(a[y]=[]),a[y].push(z.id),a},{}),k=Object.entries(u).map(([a,z])=>a==="local"?l.post(`${r.base}/process/bulk-action`,{json:{ids:z,method:s}}):Promise.all(z.map(y=>l.post(`${r.base}/remote/${a}/action/${y}`,{json:{method:s}}))));await Promise.all(k),await x(),d(`${s} action completed on ${n.size} processes`)}catch(t){i("Failed to perform bulk action: "+t.message)}},K=async()=>{try{await l.post(`${r.base}/daemon/save`,{}),d("All processes saved to dumpfile")}catch(s){i("Failed to save processes: "+s.message)}},B=async()=>{try{await l.post(`${r.base}/daemon/restore`,{}),x(),d("All processes restored from dumpfile")}catch(s){i("Failed to restore processes: "+s.message)}},F=c.value.filter(s=>{const t=h===""||s.name.toLowerCase().includes(h.toLowerCase())||s.server.toLowerCase().includes(h.toLowerCase()),u=p==="all"||s.status===p;return t&&u});return o.useEffect(()=>{x()},[]),P?e.jsx(M,{}):c.isEmpty()?e.jsxs(o.Fragment,{children:[e.jsx(I,{toasts:f,onClose:m}),e.jsx(E,{name:"No processes running",description:"Start managing your processes with OPM.",children:e.jsx("button",{type:"button",onClick:x,className:"transition inline-flex items-center justify-center space-x-1.5 border focus:outline-none focus:ring-0 focus:ring-offset-0 focus:z-10 shrink-0 border-zinc-900 hover:border-zinc-800 bg-zinc-950 text-zinc-50 hover:bg-zinc-900 px-4 py-2 text-sm font-semibold rounded-lg",children:"Refresh"})}),e.jsxs("div",{className:"text-center py-12 px-4",children:[e.jsx("div",{className:"text-zinc-400 text-lg mb-4",children:"No processes are currently running"}),e.jsxs("div",{className:"text-zinc-500 text-sm space-y-2 max-w-2xl mx-auto",children:[e.jsx("p",{children:"Start a new process using the OPM CLI:"}),e.jsx("code",{className:"block bg-zinc-900 border border-zinc-800 rounded-lg px-4 py-3 text-left text-zinc-300 font-mono text-sm mt-4",children:"opm start <script> --name <name>"}),e.jsxs("p",{className:"mt-4 text-xs text-zinc-400",children:["For more commands, run: ",e.jsx("code",{className:"bg-zinc-800 px-2 py-1 rounded",children:"opm --help"})]})]})]})]}):e.jsxs(o.Fragment,{children:[e.jsx(I,{toasts:f,onClose:m}),e.jsx(E,{name:`Viewing ${F.length} of ${c.count()} items`,description:"View and manage all the processes on your daemons.",children:e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[R&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"inline-flex items-center px-3 py-2 text-sm font-semibold text-zinc-300 bg-zinc-800 rounded-lg border border-zinc-700",children:[n.size," selected"]}),e.jsx("button",{type:"button",onClick:()=>$("restart"),className:"transition inline-flex items-center justify-center space-x-1.5 border focus:outline-none focus:ring-0 focus:ring-offset-0 focus:z-10 shrink-0 border-green-700 hover:border-green-600 bg-green-600 text-white hover:bg-green-700 px-3 py-2 text-sm font-semibold rounded-lg",children:"Restart"}),e.jsx("button",{type:"button",onClick:()=>$("stop"),className:"transition inline-flex items-center justify-center space-x-1.5 border focus:outline-none focus:ring-0 focus:ring-offset-0 focus:z-10 shrink-0 border-amber-700 hover:border-amber-600 bg-amber-600 text-white hover:bg-amber-700 px-3 py-2 text-sm font-semibold rounded-lg",children:"Stop"}),e.jsx("button",{type:"button",onClick:()=>$("delete"),className:"transition inline-flex items-center justify-center space-x-1.5 border focus:outline-none focus:ring-0 focus:ring-offset-0 focus:z-10 shrink-0 border-red-700 hover:border-red-600 bg-red-600 text-white hover:bg-red-700 px-3 py-2 text-sm font-semibold rounded-lg",children:"Delete"}),e.jsx("button",{type:"button",onClick:_,className:"transition inline-flex items-center justify-center space-x-1.5 border focus:outline-none focus:ring-0 focus:ring-offset-0 focus:z-10 shrink-0 border-zinc-700 hover:border-zinc-600 bg-zinc-800 text-zinc-50 hover:bg-zinc-700 px-3 py-2 text-sm font-semibold rounded-lg",children:"Clear"})]}),!R&&e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:O,className:"transition inline-flex items-center justify-center space-x-1.5 border focus:outline-none focus:ring-0 focus:ring-offset-0 focus:z-10 shrink-0 border-zinc-700 hover:border-zinc-600 bg-zinc-800 text-zinc-50 hover:bg-zinc-700 px-3 py-2 text-sm font-semibold rounded-lg",children:"Select All"}),e.jsx("button",{type:"button",onClick:K,className:"transition inline-flex items-center justify-center space-x-1.5 border focus:outline-none focus:ring-0 focus:ring-offset-0 focus:z-10 shrink-0 border-zinc-700 hover:border-zinc-600 bg-zinc-800 text-zinc-50 hover:bg-zinc-700 px-3 py-2 text-sm font-semibold rounded-lg",children:"Save All"}),e.jsx("button",{type:"button",onClick:B,className:"transition inline-flex items-center justify-center space-x-1.5 border focus:outline-none focus:ring-0 focus:ring-offset-0 focus:z-10 shrink-0 border-zinc-700 hover:border-zinc-600 bg-zinc-800 text-zinc-50 hover:bg-zinc-700 px-3 py-2 text-sm font-semibold rounded-lg",children:"Restore All"})]}),e.jsx("button",{type:"button",onClick:x,className:"transition inline-flex items-center justify-center space-x-1.5 border focus:outline-none focus:ring-0 focus:ring-offset-0 focus:z-10 shrink-0 border-zinc-900 hover:border-zinc-800 bg-zinc-950 text-zinc-50 hover:bg-zinc-900 px-4 py-2 text-sm font-semibold rounded-lg",children:"Refresh"})]})}),e.jsxs("div",{className:"px-4 sm:px-6 lg:px-8 pb-4 flex flex-col sm:flex-row gap-3 sm:gap-4 items-stretch sm:items-center",role:"search","aria-label":"Search and filter processes",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",placeholder:"Search by name or server...",value:h,onChange:s=>w(s.target.value),"aria-label":"Search processes by name or server",className:"w-full px-4 py-2.5 bg-zinc-900/50 border border-zinc-700/50 rounded-lg text-zinc-200 placeholder-zinc-500 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 transition-all"})}),e.jsx("div",{className:"sm:w-auto w-full",children:e.jsxs("select",{value:p,onChange:s=>S(s.target.value),"aria-label":"Filter processes by status",className:"w-full sm:w-auto px-4 py-2.5 bg-zinc-900/50 border border-zinc-700/50 rounded-lg text-zinc-200 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 transition-all",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"online",children:"Online"}),e.jsx("option",{value:"stopped",children:"Stopped"}),e.jsx("option",{value:"crashed",children:"Crashed"})]})})]}),e.jsx("ul",{role:"list",className:"px-4 sm:px-6 lg:px-8 pb-8 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 sm:gap-6 xl:gap-8 fade-in",children:F.map(s=>e.jsxs("li",{className:"group rounded-xl border border-zinc-700/50 bg-zinc-900/10 hover:bg-zinc-900/40 hover:border-zinc-600 relative transition-all duration-300 card-hover shadow-lg hover:shadow-2xl overflow-hidden",children:[e.jsx("div",{className:"absolute top-3 left-3 z-10",children:e.jsx("input",{type:"checkbox",checked:n.has(s.id),onChange:t=>{t.stopPropagation(),D(s.id)},className:"h-4 w-4 rounded border-zinc-600 bg-zinc-800 text-blue-600 focus:ring-2 focus:ring-blue-500 focus:ring-offset-0 focus:ring-offset-zinc-900 cursor-pointer transition-all"})}),e.jsxs("div",{className:"flex items-center gap-x-4 border-b border-zinc-800/80 bg-zinc-900/30 px-4 py-3.5 pl-12 rounded-t-xl backdrop-blur-sm",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(ee,{base:r.base,server:s.server,process_id:s.id,callback:x,old:s.name,onSuccess:d,onError:i}),e.jsx("div",{className:"text-xs font-medium text-zinc-400 mt-0.5",children:s.server!="local"?s.server:"Internal"})]}),e.jsxs("span",{className:"relative flex h-2.5 w-2.5 -mt-3.5",children:[e.jsx("span",{className:`${A[s.status]} absolute inline-flex h-full w-full rounded-full opacity-75 ${s.status==="online"?"animate-ping":""}`}),e.jsx("span",{className:`${A[s.status]} relative inline-flex rounded-full h-2.5 w-2.5 shadow-lg`})]}),e.jsxs(q,{as:"div",className:"relative",children:[e.jsx(J,{className:"transition border focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:ring-offset-0 z-50 shrink-0 border-zinc-700/50 bg-transparent hover:bg-zinc-800 hover:border-zinc-600 p-2 text-sm font-semibold rounded-lg",children:e.jsx(Q,{className:"h-5 w-5 text-zinc-300 hover:text-zinc-50 transition-colors","aria-hidden":"true"})}),e.jsx(Z,{as:o.Fragment,enter:"transition ease-out duration-100",enterFrom:"transform opacity-0 scale-95",enterTo:"transform opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100 scale-100",leaveTo:"transform opacity-0 scale-95",children:e.jsxs(U,{anchor:{to:"bottom end",gap:"8px",padding:"16px"},className:"z-10 w-48 origin-top-right rounded-lg bg-zinc-900 border border-zinc-800 shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none text-base divide-y divide-zinc-800/50",children:[e.jsxs("div",{className:"p-1.5",children:[!v(s.status)&&e.jsx(j,{children:({focus:t})=>e.jsx("a",{onClick:()=>g(s,"start"),className:N(t?"bg-emerald-700/10 text-emerald-500":"text-zinc-200","rounded-md block px-2 py-2 w-full text-left cursor-pointer"),children:"Start"})}),e.jsx(j,{children:({focus:t})=>e.jsx("a",{onClick:()=>g(s,"restart"),className:N(t?"bg-green-700/10 text-green-500":"text-zinc-200","rounded-md block px-2 py-2 w-full text-left cursor-pointer"),children:"Restart"})}),e.jsx(j,{children:({focus:t})=>e.jsx("a",{onClick:()=>g(s,"reload"),className:N(t?"bg-blue-700/10 text-blue-500":"text-zinc-200","rounded-md block px-2 py-2 w-full text-left cursor-pointer"),children:"Reload"})}),e.jsx(j,{children:({focus:t})=>e.jsx("a",{onClick:()=>g(s,"stop"),className:N(t?"bg-yellow-400/10 text-amber-500":"text-zinc-200","rounded-md block p-2 w-full text-left cursor-pointer"),children:"Terminate"})})]}),e.jsx("div",{className:"p-1.5",children:e.jsx(j,{children:({_:t})=>e.jsx("a",{onClick:()=>g(s,"flush"),className:"text-zinc-200 rounded-md block p-2 w-full text-left cursor-pointer hover:bg-zinc-800/80 hover:text-zinc-50",children:"Clean Logs"})})}),e.jsx("div",{className:"p-1.5",children:e.jsx(j,{children:({focus:t})=>e.jsx("a",{onClick:()=>g(s,"delete"),className:N(t?"bg-red-700/10 text-red-500":"text-red-400","rounded-md block p-2 w-full text-left cursor-pointer"),children:"Delete"})})})]})})]})]}),e.jsx("a",{href:L(s)?`./view/${s.id}?server=${s.server}`:`./view/${s.id}`,className:"block transition-colors duration-200 hover:bg-zinc-900/20",children:e.jsxs("dl",{className:"-my-3 divide-y divide-zinc-800/30 px-6 py-4 text-sm leading-6",children:[e.jsxs("div",{className:"flex justify-between gap-x-2 py-2 transition-colors hover:text-zinc-300",children:[e.jsx("dt",{className:"text-zinc-600 font-medium",children:"cpu usage"}),e.jsx("dd",{className:"text-zinc-400 font-mono",children:v(s.status)?s.cpu:"offline"})]}),e.jsxs("div",{className:"flex justify-between gap-x-2 py-2 transition-colors hover:text-zinc-300",children:[e.jsx("dt",{className:"text-zinc-600 font-medium",children:"memory"}),e.jsx("dd",{className:"text-zinc-400 font-mono",children:v(s.status)?s.mem:"offline"})]}),e.jsxs("div",{className:"flex justify-between gap-x-2 py-2 transition-colors hover:text-zinc-300",children:[e.jsx("dt",{className:"text-zinc-600 font-medium",children:"pid"}),e.jsx("dd",{className:"text-zinc-400 font-mono",children:v(s.status)?s.pid:"none"})]}),e.jsxs("div",{className:"flex justify-between gap-x-2 py-2 transition-colors hover:text-zinc-300",children:[e.jsx("dt",{className:"text-zinc-600 font-medium",children:"uptime"}),e.jsx("dd",{className:"text-zinc-400 font-mono",children:v(s.status)?s.uptime:"none"})]}),e.jsxs("div",{className:"flex justify-between gap-x-2 py-2 transition-colors hover:text-zinc-300",children:[e.jsx("dt",{className:"text-zinc-600 font-medium",children:"restarts"}),e.jsx("dd",{className:"text-zinc-400 font-mono",children:s.restarts==0?"none":s.restarts})]})]})})]},s.id+s.name))})]})};export{de as default};
